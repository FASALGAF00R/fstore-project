<!DOCTYPE html>
<html lang="en">

<head>
	<title>cart</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
	<!-- login -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
	<!-- signup -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
	<!-- phone -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
	<!-- verifyotp -->

	<!-- sign in link for admin bootstrap -->

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.min.css">
	<link href="../assets/vendor/fonts/circular-std/style.css" rel="stylesheet">
	<link rel="stylesheet" href="../assets/libs/css/style.css">
	<link rel="stylesheet" href="../assets/vendor/fonts/fontawesome/css/fontawesome-all.css">



	<!--===============================================================================================-->
	<link rel="icon" type="image/png" href="user/images/icons/favicon.png" />
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="user/vendor/bootstrap/css/bootstrap.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="user/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="user/fonts/iconic/css/material-design-iconic-font.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="user/fonts/linearicons-v1.0.0/icon-font.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="user/vendor/animate/animate.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="user/vendor/css-hamburgers/hamburgers.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="user/vendor/animsition/css/animsition.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="user/vendor/select2/select2.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="user/vendor/daterangepicker/daterangepicker.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="user/vendor/slick/slick.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="user/vendor/MagnificPopup/magnific-popup.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="user/vendor/perfect-scrollbar/perfect-scrollbar.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="user/css/util.css">
	<link rel="stylesheet" type="text/css" href="user/css/main.css">
	<!--===============================================================================================-->

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">


</head>

<style>
	table.table-bordered {
		border: 2px solid #191b1c;
	}

	table.table-bordered th,
	table.table-bordered td {
		border: 3px solid #585454;
		vertical-align: middle;
	}

	table thead {
		background-color: #f8f9fa;
	}
</style>


<body>


	<!-- Header -->
	<header>
		<!-- Header desktop -->
		<div class="container-menu-desktop fix-menu-desktop">
			<!-- Topbar -->
			<div class="top-bar">
				<div class="content-topbar flex-sb-m h-full container">
					<div class="left-top-bar">
						exclusive deals
					</div>

					<div class="right-top-bar flex-w h-full">

					</div>
				</div>
			</div>

			<div class="wrap-menu-desktop" style="top: 40px;">
				<nav class="limiter-menu-desktop container">


					<!-- Logo desktop -->
					<a href="#" class="logo">
						<img src="user/images/icons/logo-01.png" alt="IMG-LOGO">
					</a>

					<!-- Menu desktop -->
					<div class="menu-desktop">
						<ul class="main-menu">
							<li>
								<a href="/home">Home</a>
							</li>

							<li>
								<a href="/shop">Shop</a>
							</li>

							<li>
								<a href="/cart">Cart</a>
							</li>

							<li>
								<a href="/order">Order</a>
							</li>

							<li>
								<a href="/about">About</a>
							</li>

							<li>
								<a href="/contact">Contact</a>
							</li>
							<% if (name) { %>
								<li>
									<a href="/userprofile">
										<i class="fas fa-user"></i>&nbsp;&nbsp;&nbsp;&nbsp;<%= name %>
									</a>
								</li>
								<% } else{ %>
									<li>
										<a href="/userprofile">
											<i class="fas fa-user"></i>
										</a>
									</li>

									<% } %>



						</ul>
					</div>

					<!-- Icon header -->
					<div class="wrap-icon-header flex-w flex-r-m">
						<% if ( isloggedin) { %>
							<li>
								<a href="/logout" style="color: #ff0000;">Logout</a>
							</li>
							<% } else { %>
								<li>
									<b>
										<a href="/login">
											<h5 style="color:rgb(99, 101, 110);"><B>Login</B></h5>
										</a>
									</b>
								</li>
								<% } %>
					</div>


					<div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 js-show-modal-search">


					</div>


					<style>
						.icon-header-item:hover {
							text-decoration: none;

							cursor: default;

						}
					</style>

					<a href="/cart">
						<div class="icon-header-item cl2 p-r-11 p-l-10">
							<i class="zmdi zmdi-shopping-cart"></i>
						</div>
					</a>

					<a href="/wishlist" class="dis-block icon-header-item cl2 p-l-22 p-r-11">
						<i class="zmdi zmdi-favorite-outline"></i>
					</a>

			</div>
			</nav>
		</div>
		</div>



		<!-- Header Mobile -->
		<div class="wrap-header-mobile">
			<!-- Logo moblie -->
			<div>
				<a href="#" class="logo">
					<img src="user/images/icons/logo-01.png" alt="IMG-LOGO">
				</a>
			</div>


			<!-- Icon header -->
			<div class="wrap-icon-header flex-w flex-r-m m-r-15">


				<a href="/cart">
					<div class="icon-header-item cl2 hov-cl1 trans-04 p-r-11 p-l-10  ">
						<i class="zmdi zmdi-shopping-cart"></i>
					</div>
				</a>
				<a href="/wishlist" class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 ">
					<i class="zmdi zmdi-favorite-outline"></i>
				</a>
			</div>




			<!-- Button show menu -->
			<div class="btn-show-menu-mobile hamburger hamburger--squeeze">
				<span class="hamburger-box">
					<span class="hamburger-inner"></span>
				</span>
			</div>
		</div>




		<!-- Menu Mobile -->
		<div class="menu-mobile">


			<ul class="main-menu-m">
				<li>
					<a href="home">Home</a>
				</li>

				<li>
					<a href="/shop">Shop</a>
				</li>

				<li>
					<a href="/cart">Cart</a>
				</li>

				<li>
					<a href="/order">Order</a>
				</li>

				<li>
					<a href="/about">About</a>
				</li>

				<li>
					<a href="/contact">Contact</a>
				</li>


				<li>
					<a href="/userprofile">
						<i class="fas fa-user"></i>

					</a>
				</li>


			</ul>
		</div>

	</header>
	<br>
	<br>



	<% if(count>0){ %>
		<!-- Shoping Cart -->
		<form class="bg0 p-t-75 p-b-85">
			<div class="container">
				<div class="row">
					<div class="col-lg-10 col-xl-7 m-lr-auto m-b-50">

						<div class="m-l-25 m-r--38 m-lr-0-xl">
							<div class="wrap-table-shopping-cart">
								<div class="my-4">
									<table class="table table-bordered" id="categorytable">
										<tr class="table_head">

											<th class="column-1">Product</th>
											<th class="column-2">Name</th>
											<th class="column-3">Price</th>
											<th class="column-4">Quantity</th>
											<th class="column-5">Total</th>
										</tr>
										<% for(let i=0 ; i<usercart.products.length ; i++) {%>
											<tr class="table_row">
												<td class="column-0">
													<%= [i+1] %>
												</td>
												<td class="column-1">
													<div class="how-itemcart1">
														<img src="/productimages/<%= products[i].image[0] %>" alt="IMG">
													</div>
												</td>
												<td class="column-2">
													<%= products[i].name %>
												</td>
												<td class="column-3">
													<%= products[i].price %>

												</td>
												<td class="column-4">
													<div class="wrap-num-product flex-w m-l-auto m-r-0">
														<div
															class="btn-num-product-down cl8 hov-btn3 trans-04 flex-c-m">
															<button id="minusButton" type="button"
																onclick="changeQuantity('<%=usercart._id%>','<%=products[i]._id%>' ,-1, '<%=usercart.products[i]._id %>'  )">-</button>
														</div>
														<span
															class="mtext-104 cl3 num-product text-center d-flex align-items-center justify-content-center"
															id="<%= products[i]._id %>"
															style="width: 40px; height: 40px; border: 1px solid #ccc; border-radius: 5px;">
															<%= usercart.products[i].quantity %>
														</span>


														<div class="btn-num-product-up cl8 hov-btn3 trans-04 flex-c-m">
															<button type="button"
																onclick="changeQuantity  ( '<%= usercart._id%>' , '<%=products[i]._id%>' ,1, '<%=usercart.products[i]._id %>'  )">+</button>
														</div>
													</div>
								</div>
							</div>
							</td>
							<td class="column-5" id="<%= usercart.products[i]._id%>">
								<%=products[i].price* usercart.products[i].quantity %>
							</td>
							<td class="column-6 cart__close">
								<a href="/removecart?id=<%= products[i]._id %>" class="btn btn-danger btn-sm">
									🗑 Remove
								</a>
							</td>
							<td class="column-6"><a href="/cart-to-wishlist?id=<%= products[i]._id %>"><img
										class="icon-heart1 dis-block trans-04"></a>
							</td>


							</tr>
							<% } %>
								</table>
						</div>


					</div>

				</div>

				<style>
					.cart-content {
						margin-bottom: 2px;
					}
				</style>

				<div class="col-lg-10 col-xl-7 m-lr-auto m-b-50 cart-content">

					<div class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm">
						<h4 class="mtext-109 cl2 p-b-30">
							Cart Totals
						</h4>

						<div class="flex-w flex-t bor12 p-b-13">
							<div class="size-208">
								<span class="stext-110 cl2">
									Subtotal:
								</span>
							</div>

							<div class="size-209">
								<span class="mtext-110 cl2" id="userCartTotal">
									Rs <%= usercart.Total %>
								</span>
							</div>
						</div>

						<div class="flex-w flex-t bor12 p-t-15 p-b-30">
							<div class="size-208 w-full-ssm">
								<span class="stext-110 cl2">
									Shipping:
								</span>
							</div>

							<div class="size-209 p-r-18 p-r-0-sm w-full-ssm">
								<p class="stext-111 cl6 p-t-2">
									Free
								</p>

							</div>
						</div>
					</div>

					<div class="flex-w flex-t p-t-27 p-b-33">
						<div class="size-208">
							<span class="mtext-101 cl2">
								Total:
							</span>
						</div>

						<div class="size-209 p-t-1">
							<span class="mtext-110 cl2" id="userCartTotal2">
								Rs <%= usercart.Total %>
							</span>
						</div>
					</div>


					<a href="/checkout"
						class="flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer">
						Proceed to Checkout
					</a>

				</div>
			</div>
			</div>
			</div>
	<% }else{ %>
				<br>
				<br>

				<div class="container-fluid ">
					<div class="row">
						<div class="col-md-12">
							<div class="card">
								<div class="card-body cart">
									<div class="col-sm-12 empty-cart-cls text-center">
										<img src="https://i.imgur.com/dCdflKN.png" width="130" height="130"
											class="img-fluid mb-4 mr-3">
										<h3><strong>Your Cart is Empty</strong></h3><br>
										<h4>Add items to it now</h4>
										<a href="/shop" class="btn btn-dark cart-btn-transform m-3"
											data-abc="true">continue
											shopping</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<% } %>
		</form>




		<script src="assets/vendor/jquery/jquery-3.2.1.min.js"></script>
		<script>

			function changeQuantity(cartID, productID, count, userProductID) {
				let quantity = parseInt(document.getElementById(productID).innerHTML)
				let currentTotal = parseInt(document.getElementById(userProductID).innerHTML)
				count = parseInt(count)
				$.ajax({
					url: '/changeproductquantity',
					data: {
						cart: cartID,
						product: productID,
						count: count,
						quantity: quantity,
						currentTotal: currentTotal
					},
					method: 'post',
					success: (response) => {
						if (response.empty) {
							location.reload()
						} else {
							document.getElementById(productID).innerHTML = quantity + count
							document.getElementById(userProductID).innerHTML = response.currentTotal
							document.getElementById('usercartTotal').innerHTML = "Rs " + response.sum
							document.getElementById('usercartTotal2').innerHTML = "Rs " + response.sum
						}
					}
				})
			}

		</script>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>
		<br>

		<%- include('../user/partials/footer.ejs') %>